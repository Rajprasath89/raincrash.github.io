<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Copyleftgames - Deferred Renderer &middot; Bits, Pixels and Atoms
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/naringu.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/form.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="./public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="Mozilla RSS" href="feed.category.xml">
  </head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61456015-1', 'auto');
  ga('send', 'pageview');

</script>


<body class="theme-6dd">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
      <img width="125" height="125" alt="A photo of ariestiyansyah" src="/images/head.png">
    <p>Random tech musing by Sricharan Chiruvolu</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/categories/">Category Index</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/contact/">Contact</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <a class="sidebar-nav-item" href="/assets/resume.pdf">Resume</a>
    <span class="sidebar-nav-item">Version 2.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Bits, Pixels and Atoms</a>
            <small>Random tech musing by Sricharan Chiruvolu</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Copyleftgames - Deferred Renderer</h1>
  <span class="post-date">30 Mar 2015</span>
  <h1>Deferred Rendering pipeline for Pysoy</h1>

<p><em>Proposal for Google Summer of Code - 2015   CopyLeftGames.org</em></p>

<h1><em>Personal details</em></h1>

<p><strong>Name:</strong> Sricharan Chiruvolu ( IRC - raincrash / sricharanized )</p>

<p><strong>Email:</strong> sricharanized(at)gmail(dot)com</p>

<p><strong>Degree:</strong> B.Tech, Computer Science and Engineering</p>

<p><strong>College/ Univ:</strong> Amrita School of Engineering, Bengaluru, India</p>

<h1>SYNOPSIS</h1>

<p>Classing rendering (also called forward rendering) can, in the worst case, require num<em>objects * num</em>lights batches to render a scene. Deferred shading changes that to num<em>objects + num</em>lights, which can often be a lot less. We can thus achieve O(1) depth complexity for lighting. Memory is no longer an issue. So, pysoy can migrate to a deferred renderer.</p>

<p>Aim to create a deferred rendering pipeline that is as unobtrusive as possible – we do not want the users of the engine to have to use it differently because of the way that its rendered. So, we want an engine that can:</p>

<ul>
<li>Interact with the game engine in the same way that the forward renderer does.</li>
<li>The pipeline switch should still be as flexible as forward rendering.</li>
</ul>

<p>Working on optimization techniques including Stencil culling algorithm for rendering deferred lights and scissor rectangles. Multiple Render Targets (MRT) capability.</p>

<p>Compactability of adding some advanced post-filters without another full scene render.</p>

<p>The Deferred rendering architecture will include the following stages:
- Geometry stage 
- Lighting stage 
- Post-processing stage
- View stage</p>

<h1><em>Motivation</em></h1>

<p>In a standard forward rendering pipeline, the lighting calculations have to be performed on every vertex and on every fragment in the visible scene, for every light in the scene. The expensive lighting calculations have to execute for each visible fragment of every polygon on the screen, regardless if it overlaps or is hidden by another polygon&#39;s fragments. </p>

<p>Also, many of the fragments will never make it to the screen because they were removed with depth testing, and thus the lighting calculation was wasted on them. </p>

<p>Classing rendering (also called forward rendering) can, in the worst case, require num<em>objects * num</em>lights batches to render a scene. Deferred shading changes that to num<em>objects + num</em>lights, which can often be a lot less. We can thus achieve O(1) depth complexity for lighting.</p>

<p>If we migrate to deferred rendering pipeline we can easily extend the deferred renderer to calculate light volume mapping, extend to various post-effect schemes (new post-processing effects are easily achievable using the G-Buffer as input. If  we wanted to perform these effects without deferred shading, we would&#39;ve had to render the whole scene again) e.t.c.</p>

<h1><em>Project Proposal</em></h1>

<h2>Implementation plan</h2>

<p>Refactoring is the key. We will have to create a deferred rendering pipeline that is as unobtrusive as possible – we do not want the users of the engine to have to use it differently because of the way that its rendered. So, we want an engine that can:</p>

<ol>
<li>Interact with the game engine in the same way that the forward renderer does.</li>
<li>The pipeline switch should still be as flexible as forward rendering.</li>
</ol>

<p>The second issue is the optimization. We need to make sure G-Buffer pass is cheap. There are a lot of optimization methods that can be implemented, clipping, occlusion query, stencil cull, etc. We will be working on using Stencil culling algorithm for rendering deferred lights.</p>

<p>In the beginning, all of the objects render their &quot;lighting related info&quot; to a texture, the G-Buffer. This means their colours, normals, depths and any other info that might be relevant to calculating their final colour. </p>

<p>Then, the lights in the scene are rendered as geometry (sphere for point light, cone for spotlight and full screen quad for directional light), and they use the G-buffer to calculate the colour contribution of that light to that pixel.</p>

<p>In order to write to all its buffers, it would require rendering one pass per buffer. However, if the current graphics card supports Multiple Render Targets (MRT) capability, it is possible to write to all buffers in a single pass. We won&#39;t render the scene straight to the back buffer; instead we render everything into a bunch of textures using a multiple render target (MRT). With MRTs we can render into different textures with a single call. This will avoid to transform the vertices more than once boosting our performance.</p>

<h2>Deferred Rendering</h2>

<p>We will have four distinct stages in deferred shading: geometry stage, lighting stage, post-processing stage and final stage.</p>

<p><strong>We will first implement a G-Buffer.</strong></p>

<p><strong>Geometry stage</strong></p>

<p>We will make the G-Buffer as the current render target. Once that the G-buffer is ready to receive data, the scene will be rendered. Firstly, we update the G-buffer&#39;s depth buffer. Next, material and geometric information of the scene are sent and a fragment shader is responsible for filling the rest of the G-buffer&#39;s data.</p>

<p>We have to postpone the transparent objects at this stage. An inspect pass will decide that the object is transparent, we will not add an auto-generated pass to the GBuffer, but instead copy it to render it regularly later (in final stage).</p>

<p>Another way of handling transparent objects for cheap lighting is:  <a href="http://www.john-chapman.net/content.php?id=13">this</a> . We can implement this idea as it is.</p>

<p><strong>What data is passed to the G-Buffer</strong></p>

<p>The four textures generated by the material pass would include: (a) normal, (b) diffuse, (c) specular and (d) encoded depth as color.Choosing a texture format is not a trivial decision, and has quite a big impact on performance. Further research will be done prior implementation.</p>

<p><strong>Lighting stage</strong></p>

<p>The output of the geometry stage is the G-Buffer contents. They are the normal, diffuse, spcular and depth maps and will be the input for our lighting pass shader together with per light related information like position, color and radius.</p>

<p>We now have a prepared G-buffer with all the intermediate data we need to light the scene. Now, we will render each light to the scene, calculating its contribution to the final image.</p>

<p>When using deferred shading we do not need to know what geometry is illuminated by what light and could just process all lights we find visible to the viewer. While we traverse the scene for visible geometry we simply store the lights we find on the way (so lights do not need to know which geometry they will influence). </p>

<p>We will use view culling applied to the light volumes and some type of occlusion culling to try to reduce the number of lights we need to render.</p>

<p>We will also be using <a href="http://kayru.org/articles/deferred-stencil/">Stencil culling algorithm</a> for rendering deferred lights.</p>

<p><strong>Post-processing stage</strong></p>

<p>Another advantage of deferred rendering, is that some advanced post-filters require full-scene renders to get intermediate information about the scene and use it. If the G-Buffer contains this information, we can apply these effects without another full scene render. </p>

<p>We will make sure that it is easy to pass information (such as textures) from different render sequences to each other.</p>

<p><strong>Final Stage</strong></p>

<p>The final image is shown; swap the buffers and show the scene. This might scale the resulting image to fit the target view window dimensions as the buffers used for deferred shading can have a different resolution than the final screen resolution.</p>

<p>At this stage, we can take care of the transparent objects, as mentioned <a href="http://www.john-chapman.net/content.php?id=13">here</a>.</p>

<p>Thus, a new rendering pipeline is developed.</p>

<h3>References and cool links</h3>

<p>I found the following references useful, although some not directly appropriate for our use.</p>

<ul>
<li><a href="https://hal.inria.fr/inria-00480869/document">Deferred Rendering Architecture</a></li>
<li><a href="http://http.developer.nvidia.com/GPUGems3/gpugems3_ch19.html">GPU Gems - Nvidia</a></li>
<li><a href="http://www.gamedev.net/page/resources/_/technical/graphics-programming-and-theory/deferred-rendering-demystified-r2746">Deferred Rendering Demystified</a></li>
<li><a href="http://www.john-chapman.net/content.php?id=13">Transparency - A</a></li>
<li><a href="http://techblog.floorplanner.com/rendering-transparency-in-a-deferred-pipeline/">Transparency - B</a></li>
</ul>

<p><strong>Beyond GsoC</strong></p>

<p>Once such deferred renderer is developed, it can be extended to support:</p>

<ul>
<li>Shadow mapping</li>
<li>Light volume clipping</li>
<li>Add new post-effects such as SSAO using the post-effect system</li>
</ul>

<p>I will also be working on transition of ODE-based to a new physics engine.</p>

<p>I will be contributing to the development of the organization, especially with adding WebGL and HTML (plugin free) client support.</p>

<p>We can work on this as a non-deadline based project or chop them into various GCI tasks.</p>

<h1>Availability</h1>

<p>I’m pretty sure that i’ll be able to devote about 40 - 50 hours every week to the project during the GSoC coding period. </p>

<h1>Issues/ Shortcomings</h1>

<ol>
<li><p>There are several algorithmic drawbacks with deferred shading - transparent objects are hard to handle, anti-aliasing can not be used on legacy hardware, additional memory consumption because of the G-Buffer.</p></li>
<li><p>In addition to that, deferred shading is harder to implement - it overrides the entire pipeline. Pretty much everything is rendered using manual shaders - which probably means a lot of shader code.</p></li>
</ol>

<h1>About me</h1>

<ul>
<li><a href="/index.html">About</a></li>
</ul>

<p>I am planning to blog my progress atleast once in two weeks. I think this is a good way to post progress on my project.</p>

<p>I am fairly new to GSoC as this will be my first experience, but I am looking forward to build this amazing application with you and begin my journey in Open Source!</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2015/08/10/genetic-algorithms-hello-world/">
            A "Hello World!" to the genetic algorithms
            <small>10 Aug 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/gsoc/2015/06/05/pysoy-pysoy-development-part-two/">
            [Pysoy] - Pysoy Development, Part Two
            <small>05 Jun 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/web%20dev/2015/06/05/the-new-web-development-treads/">
            The new web development trends
            <small>05 Jun 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

<div class="comments">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'bitspixelsandatoms';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'bitspixelsandatoms';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>

    <div align="center" class="footer">
    <br />
    <a href="https://twitter.com/TheRaincrash" class="twitter-follow-button" data-show-count="false" data-size="large" data-dnt="true">Follow @TheRaincrash</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    <br/>
    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Bits, Pixels and Atoms</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="mailto:sricharanized@gmail.com" property="cc:attributionName" rel="cc:attributionURL">Sricharan Chiruvolu</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons License.</a><br/>
    </div>
  </body>
</html>

